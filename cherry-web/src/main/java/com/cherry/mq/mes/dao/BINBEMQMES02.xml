<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BINBEMQMES02">
	<!-- 销售主表Key -->
	<sql id="saleKeyMainSql">
			BIN_OrganizationInfoID,
			BIN_BrandInfoID,
			BIN_OrganizationID,
			BIN_MachineInfoID,
			MachineCode,
			SaleRecordCode,
			BillCode,
			BillCodePre,
			CounterTicketCode,
			CounterTicketCodePre,
			SaleType,
			TicketType,
			ConsumerType,
			BIN_MemberInfoID,
			MemberCode,
			MemberLevel,
			<isNotEmpty property="original_amount">
				OriginalAmount,
			</isNotEmpty>
			<isNotEmpty property="discount">
				Discount,
			</isNotEmpty>
			<isNotEmpty property="pay_amount">
				PayAmount,
			</isNotEmpty>
			<isNotEmpty property="decrease_amount">
				DecreaseAmount,
			</isNotEmpty>
			<isNotEmpty property="costpoint">
				CostPoint,
			</isNotEmpty>
			<isNotEmpty property="costpoint_amount">
				CostpointAmount,
			</isNotEmpty>
			<isNotEmpty property="totalAmount">
				Amount,
			</isNotEmpty>
			Quantity,
			BillCount,
			SaleDate,
			SaleTime,
			<isNotEmpty property="sale_ticket_time">
				SaleTicketTime,
			</isNotEmpty>
			ModifiedTimes,
			Channel,
			Comments,
			<isNotEmpty property="saleReason">
				SaleReason,
			</isNotEmpty>
			<isNotEmpty property="memberClubId">
				BIN_MemberClubID,
			</isNotEmpty>
			<isNotEmpty property="clubCode">
				ClubCode,
			</isNotEmpty>
			<isNotEmpty property="invoiceFlag">
				InvoiceFlag,
			</isNotEmpty>
			<isNotEmpty property="isPoint">
				IsPoint,
			</isNotEmpty>
			<isNotEmpty property="sensitiveSuggestVersion">
				SensitiveSuggestVersion,
			</isNotEmpty>
			<isNotEmpty property="drySuggestVersion">
				DrySuggestVersion,
			</isNotEmpty>
			<isNotEmpty property="pointFlag">
				PointFlag,
			</isNotEmpty>
	</sql>
	
	<!-- 销售主表Value -->
	<sql id="saleValueMainSql">
			#organizationInfoID#,
			#brandInfoID#,
			#organizationID#,
			#machineInfoID#,
			#machineCode#,
			#cherry_no#,
			#tradeNoIF#,
			#relevantNo#,
			#counter_ticket_code#,
			#counter_ticket_code_pre#,
			#saleType#,
			#ticket_type#,
			#consumer_type#,
			#memberInfoID#,
			#memberCode#,
			#member_level#,
			<isNotEmpty property="original_amount">
				#original_amount#,
			</isNotEmpty>
			<isNotEmpty property="discount">
				#discount#,
			</isNotEmpty>
			<isNotEmpty property="pay_amount">
				#pay_amount#,
			</isNotEmpty>
			<isNotEmpty property="decrease_amount">
				#decrease_amount#,
			</isNotEmpty>
			<isNotEmpty property="costpoint">
				#costpoint#,
			</isNotEmpty>
			<isNotEmpty property="costpoint_amount">
				#costpoint_amount#,
			</isNotEmpty>
			<isNotEmpty property="totalAmount">
				#totalAmount#,
			</isNotEmpty>
			#totalQuantity#,
			'1',
			#tradeDate#,
			#saleTime#,
			<isNotEmpty property="sale_ticket_time">
				#sale_ticket_time#,
			</isNotEmpty>
			#modifyCounts#,
			#data_source#,
			#reason#,
			<isNotEmpty property="saleReason">
				#saleReason#,
			</isNotEmpty>
			<isNotEmpty property="memberClubId">
				#memberClubId#,
			</isNotEmpty>
			<isNotEmpty property="clubCode">
				#clubCode#,
			</isNotEmpty>
			<isNotEmpty property="invoiceFlag">
				#invoiceFlag#,
			</isNotEmpty>
			<isNotEmpty property="isPoint">
				#isPoint#,
			</isNotEmpty>
			<isNotEmpty property="sensitiveSuggestVersion">
				#sensitiveSuggestVersion#,
			</isNotEmpty>
			<isNotEmpty property="drySuggestVersion">
				#drySuggestVersion#,
			</isNotEmpty>
			<isNotEmpty property="pointFlag">
				#pointFlag#,
			</isNotEmpty>
	</sql>
	
	<!-- 销售明细表Key -->
	<sql id="saleKeyDetailSql">
		<![CDATA[
				UnitCode,
				BarCode,
				DetailNo,
				InventoryTypeCode,
				EmployeeCode,
				PricePay,
		]]>
        <isNotEmpty property="discount">
				Discount,
        </isNotEmpty>
        <isNotEmpty property="saleReason">
				SaleReason,
        </isNotEmpty>
        <isNotEmpty property="tagPrice">
				Price,
        </isNotEmpty>
		<![CDATA[
				Quantity,
				SaleType,
				Comment,
				ModifiedTimes,
		]]>
	</sql>
	
	<!-- 销售明细表Value -->
	<sql id="saleValueDetailSql">
		<![CDATA[
				#unitcode#,
				#barcode#,
				#detailNo#,
				#inventoryTypeCode#,
				#BAcode#,
				#price#,
		]]>
        <isNotEmpty property="discount">
				#discount#,
		</isNotEmpty>
		<isNotEmpty property="saleReason">
				#saleReason#,
        </isNotEmpty>
        <isNotEmpty property="tagPrice">
				#tagPrice#,
        </isNotEmpty>
		<![CDATA[
				#quantity#,
				#saleType#,
				#reason#,
				#modifyCounts#,
		]]>
	</sql>
	
	<!-- 产品入出库主表Key -->
	<sql id="prtStockInOutKeyMainSql">
		<![CDATA[
	    		BIN_OrganizationInfoID,
				BIN_BrandInfoID,
				TradeNo,
				TradeNoIF,
				RelevanceNo,
				StockType,
				BIN_OrganizationID,
				BIN_EmployeeID,
				TotalQuantity,
				TotalAmount,
				TradeType,
				BIN_LogisticInfoID,
				Comments,
				StockInOutDate,
				StockInOutTime,
				VerifiedFlag,
				CloseFlag,
				ChangeCount,
		]]>
	</sql>
	
	<!-- 产品入出库主表value -->
	<sql id="prtStockInOutValueMainSql">
		<![CDATA[
    			#organizationInfoID#,
    			#brandInfoID#,
    			#stockInOut_tradeNo#,
				#stockInOut_tradeNoIF#,
    			#stockInOut_relevantNo#,
    			#stockInOutType#,
    			#organizationID#,
    			#employeeID#,
    			#totalQuantity#,
    			#totalAmount#,
    			#cherry_tradeType#,
    			'0',
    			#reason#,
    			#tradeDate#,
    			#stockInOutTime#,
    			#verifiedFlag#,
    			'0',
    			#modifyCounts#,
		]]>
	</sql>
	
	<!-- 产品入出库明细表Key -->
	<sql id="prtStockInOutKeyDetailSql">
		<![CDATA[
				BIN_ProductVendorID,
				DetailNo,
				Quantity,
				Price,
				BIN_ProductVendorPackageID,
				StockType,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Comments,
				ChangeCount,
		]]>
	</sql>
	
	<!-- 产品入出库明细表value -->
	<sql id="prtStockInOutValueDetailSql">
		<![CDATA[
     			#productVendorID#,
     			#detailNo#,
     			#quantity#,
     			#price#,
     			'0',
     			#stockType#,
     			#inventoryInfoID#,
     			#logicInventoryInfoID#,
     			'0',
     			#reason#,
     			#modifyCounts#,
		]]>
	</sql>
	
	<!-- 查询销售业务数据主表 -->
	<select id ="selSaleRecord" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
		<![CDATA[
			SELECT 
				A.BIN_SaleRecordID AS saleRecordID,
				A.BIN_OrganizationInfoID AS organizationInfoID,
				A.BIN_BrandInfoID AS brandInfoID,
				A.BIN_OrganizationID AS organizationID,
				A.BIN_MachineInfoID AS machineInfoID,
				A.MachineCode AS machineCode,
				A.BillCode AS tradeNoIF,
				A.BillCodePre AS relevantNo,
				A.CounterTicketCode AS counter_ticket_code,
				A.CounterTicketCodePre AS counter_ticket_code_pre,
				A.SaleType AS saleType,
				A.TicketType AS ticket_type,
				A.ConsumerType AS consumer_type,
				A.BIN_MemberInfoID AS memberInfoID,
				A.MemberCode AS memberCode,
				A.MemberLevel AS member_level,
				A.OriginalAmount AS original_amount,
				A.Discount AS discount,
				A.PayAmount AS pay_amount,
				A.DecreaseAmount AS decrease_amount,
				A.CostPoint AS costpoint,
				A.CostpointAmount AS costpoint_amount,
				A.Amount AS totalAmount,
				A.Quantity AS totalQuantity,
				A.SaleDate AS tradeDate,
				A.SaleTime AS saleTime,
				A.SaleTicketTime AS sale_ticket_time,
				A.ModifiedTimes AS modifyCounts,
				A.Channel AS data_source,
				A.Comments AS reason,
				A.SaleReason AS saleReason,
				A.SaleRecordCode AS cherry_no,
				A.BIN_MemberClubID AS memberClubId,
				A.ClubCode AS clubCode,
				A.InvoiceFlag AS invoiceFlag,
				A.IsPoint AS isPoint,
				A.SensitiveSuggestVersion AS sensitiveSuggestVersion,
				A.DrySuggestVersion AS drySuggestVersion
			FROM
				Sale.BIN_SaleRecord A
			WHERE
				A.ValidFlag = '1' AND
				A.BillCode = #tradeNoIF#
		]]>	
	</select>
	
	<!-- 查询销售业务数据主表通过交易时间    判断是否是重复的数据-->
	<select id ="selSaleRecordByTradeTime" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
			SELECT 
				count(*)
			FROM
				Sale.BIN_SaleRecord A
			WHERE
				A.ValidFlag = '1' AND
				A.BillCode = #tradeNoIF# AND
				A.SaleTime = #tradeDateTime#
		]]>	
		    <isNotEmpty property="modifyCounts">
				AND A.ModifiedTimes = #modifyCounts#
			</isNotEmpty>
	</select>
	
	<!-- 通过交易日期及单据号查询产品退库主表    判断是否是重复的数据-->
	<select id ="selProductReturnByNoIF" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
		 select 
              max(num) 
         from 
             (SELECT 
		           count(*) as num
	          FROM 
		           Inventory.BIN_ProductReturn A
		 
              where	
		           A.ValidFlag = '1' AND
			       A.ReturnNoIF = #tradeNoIF# AND
			       A.ReturnDate = #tradeDate#
			  
             union
		 
		     SELECT 
		          count(*) as num 
		     FROM 
		          Inventory.BIN_PromotionReturn B
		     where	
			      B.ValidFlag = '1' AND
				  B.ReturnNoIF = #tradeNoIF# AND
		          B.ReturnDate = #tradeDate# ) AS 
		    ProductANDPromotion
		]]>	
	</select>
	
	<!-- 通过交易日期及单据号查询产品入库主表    判断是否是重复的数据-->
	<select id ="selProductReceiveByNoIF" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
		 select 
              max(num) 
         from 
             (SELECT 
		           count(*) as num
	          FROM 
		           Inventory.BIN_ProductReceive A
		 
              where	
		           A.ValidFlag = '1' AND
			       A.ReceiveNoIF = #tradeNoIF#  AND
			       A.ReceiveDate = #tradeDate#
			  
             union
		 
		     SELECT 
		          count(*) as num 
		     FROM 
		          Inventory.BIN_PromotionDeliver B
		     where	
			      B.ValidFlag = '1' AND
				  B.DeliverReceiveNoIF = #tradeNoIF#  AND
		          B.DeliverDate = #tradeDate# ) AS 
		    ProductANDPromotion
		]]>	
	</select>
	
	<!-- 通过交易日期及单据号查询产品调拨主表    判断是否是重复的数据-->
	<select id ="selAllocationByAllocationNoIF" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
		 select 
              max(num) 
         from 
             (SELECT 
		           count(*) as num
	          FROM 
		           Inventory.BIN_ProductAllocation A
		 
              where	
		           A.ValidFlag = '1' AND
			       A.AllocationNoIF = #tradeNoIF#  AND
			       A.Date = #tradeDate#
			  
             union
		 
		     SELECT 
		          count(*) as num 
		     FROM 
		          Inventory.BIN_PromotionAllocation B
		     where	
			      B.ValidFlag = '1' AND
				  B.AllocationNoIF = #tradeNoIF#  AND
		          B.AllocationDate  = #tradeDate# ) AS 
		    ProductANDPromotion
		]]>	
	</select>
	
	<!-- 通过交易日期及单据号查询产品调出确认及促销产品调拨主表     判断是否是重复的数据-->
	<select id ="selAllocationOutByNoIF" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
		 select 
              max(num) 
         from 
             (SELECT 
		           count(*) as num
	          FROM 
		           Inventory.BIN_ProductAllocationOut A
		 
              where	
		           A.ValidFlag = '1' AND
			       A.AllocationOutNoIF  = #tradeNoIF#  AND
			       A.Date = #tradeDate#
			  
             union
		 
		     SELECT 
		          count(*) as num 
		     FROM 
		          Inventory.BIN_PromotionAllocation B
		     where	
			      B.ValidFlag = '1' AND
				  B.AllocationNoIF = #tradeNoIF#  AND
		          B.AllocationDate  = #tradeDate# ) AS 
		    ProductANDPromotion
		]]>	
	</select>
	
	<!-- 通过交易日期及单据号查询盘点主表     判断是否是重复的数据-->
	<select id ="selStockTakingByNoIF" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
		 select 
              max(num) 
         from 
             (SELECT 
		           count(*) as num
	          FROM 
		           Inventory.BIN_ProductStockTaking A
		 
              where	
		           A.ValidFlag = '1' AND
			       A.StockTakingNoIF  = #tradeNoIF#  AND
			       A.Date = #tradeDate#
			  
             union
		 
		     SELECT 
		          count(*) as num 
		     FROM 
		          Inventory.BIN_PromotionStockTaking B
		     where	
			      B.ValidFlag = '1' AND
				  B.StockTakingNoIF = #tradeNoIF#  AND
		          B.StockTakingDate  = #tradeDate# ) AS 
		    ProductANDPromotion
		]]>	
	</select>
	
	<!-- 通过生日礼领用单据号查询入出库主表     判断是否是重复的数据-->
	<select id ="selStockByBirPresentNoIF" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
		  select 
		      count(*) 
	      from 
		      Inventory.BIN_PromotionStockInOut A
          where  
		      A.Reason like '%$tradeNoIF$%'
		]]>	
	</select>
	
	<!-- 通过交易日期及单据号查询产品订货单  判断是否是重复的数据-->
	<select id ="selProductOrderByDateNoIF" parameterClass="java.util.HashMap" resultClass ="java.lang.Integer">
		<![CDATA[
		  SELECT  
		       COUNT(*) AS num
		  FROM 
		       Inventory.BIN_ProductOrder A
		  WHERE 
		       A.ValidFlag = '1' AND
		       A.OrderNoIF = #tradeNoIF# AND 
			   A.Date = #tradeDate#
		]]>	
	</select>
	<!-- 查询销售业务数据明细表 -->
	<select id ="selSaleRecordDetail" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
		<![CDATA[
			SELECT 
				A.BIN_SaleRecordID AS saleRecordID,
				A.UnitCode AS unitcode,
				A.BarCode AS barcode,
				A.DetailNo AS detailNo,
				A.InventoryTypeCode AS inventoryTypeCode,
				A.EmployeeCode AS BAcode,
				A.PricePay AS price,
				A.Price AS tagPrice,
				A.Discount AS discount,
				A.Quantity AS quantity,
				A.SaleType AS saleType,
				A.Comment AS reason,
				A.SaleReason AS saleReason,
				A.ModifiedTimes AS modifyCounts
			FROM
				Sale.BIN_SaleRecordDetail A
			WHERE
				A.ValidFlag = '1' AND
				A.BIN_SaleRecordID = #saleRecordID#
		]]>	
	</select>
	
    <!-- Sale.BIN_SaleRecord字段可空的Key，在历史销售主表没有的字段。 -->
    <sql id="saleRecordKeyMainSql">
        <isNotEmpty property="billState">
            <![CDATA[BillState,]]>
        </isNotEmpty>
        <isNotEmpty property="BIN_OrganizationIDDX">
            <![CDATA[BIN_OrganizationIDDX,]]>
        </isNotEmpty>
        <isNotEmpty property="BIN_EmployeeIDDX">
            <![CDATA[BIN_EmployeeIDDX,]]>
        </isNotEmpty>
        <isNotEmpty property="billModel">
            <![CDATA[BillModel,]]>
        </isNotEmpty>
        <isNotEmpty property="originalDataSource">
            <![CDATA[OriginalDataSource,]]>
        </isNotEmpty>
        <isNotEmpty property="pickupDate">
            <![CDATA[PickupDate,]]>
        </isNotEmpty>
        <isNotEmpty property="pickupStatus">
            <![CDATA[PickupStatus,]]>
        </isNotEmpty>
        <isNotEmpty property="mobilePhone">
            <![CDATA[MobilePhone,]]>
        </isNotEmpty>
    </sql>
    
    <!-- Sale.BIN_SaleRecord字段可空的Value，在历史销售主表没有的字段。 -->
    <sql id="saleRecordValueMainSql">
        <isNotEmpty property="billState">
            <![CDATA[#billState#,]]>
        </isNotEmpty>
        <isNotEmpty property="BIN_OrganizationIDDX">
            <![CDATA[#BIN_OrganizationIDDX#,]]>
        </isNotEmpty>
        <isNotEmpty property="BIN_EmployeeIDDX">
            <![CDATA[#BIN_EmployeeIDDX#,]]>
        </isNotEmpty>
        <isNotEmpty property="billModel">
            <![CDATA[#billModel#,]]>
        </isNotEmpty>
        <isNotEmpty property="originalDataSource">
            <![CDATA[#originalDataSource#,]]>
        </isNotEmpty>
        <isNotEmpty property="pickupDate">
            <![CDATA[#pickupDate#,]]>
        </isNotEmpty>
        <isNotEmpty property="pickupStatus">
            <![CDATA[#pickupStatus#,]]>
        </isNotEmpty>
        <isNotEmpty property="mobilePhone">
            <![CDATA[#mobilePhone#,]]>
        </isNotEmpty>
    </sql>
	
	<!-- 插入销售业务数据主表 -->
    <insert id="addSaleRecord" parameterClass="java.util.HashMap">
    	<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_SaleRecordID" >      
	    <![CDATA[
    		INSERT INTO Sale.BIN_SaleRecord
    		(
    			]]>
					<include refid="BINBEMQMES02.saleKeyMainSql" />	
					<![CDATA[
					   BIN_EmployeeID,
                       EmployeeCode,
					]]>
                    <include refid="BINBEMQMES02.saleRecordKeyMainSql" />
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
    		VALUES
    		(
    			 ]]>
					<include refid="BINBEMQMES02.saleValueMainSql" />
					<![CDATA[
					   #employeeID#,
                       #BAcode#,
					]]>
                    <include refid="BINBEMQMES02.saleRecordValueMainSql" />
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
    		)
			  	  SELECT SCOPE_IDENTITY() AS value     
			]]> 
	    </selectKey>
    </insert>
    
    <!-- 插入销售业务数据明细表 -->
    <insert id="addSaleRecordDetail" parameterClass="java.util.HashMap">
    	<![CDATA[
    		INSERT INTO Sale.BIN_SaleRecordDetail
    		(
    			BIN_SaleRecordID,
				BIN_ProductVendorID,
    			]]>
        <isNotEmpty property="activityMainCode">
            <![CDATA[MainCode,]]>
        </isNotEmpty>
        <isNotEmpty property="activityCode">
            <![CDATA[CountActCode,]]>
        </isNotEmpty>
        <isNotEmpty property="uniqueCode">
            <![CDATA[UniqueCode,]]>
        </isNotEmpty>
					<include refid="BINBEMQMES02.saleKeyDetailSql" />		
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
    		VALUES
    		(
    			#saleRecordID#,
		]]>
        <isNotEmpty property="isPromotion">
            <isEqual property="isPromotion" compareValue="0">
                <![CDATA[#productVendorID#,]]>
            </isEqual>
            <isEqual property="isPromotion" compareValue="1">
                <![CDATA[#promotionProductVendorID#,]]>
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="activityMainCode">
            <![CDATA[#activityMainCode#,]]>
        </isNotEmpty>
        <isNotEmpty property="activityCode">
            <![CDATA[#activityCode#,]]>
        </isNotEmpty>
        <isNotEmpty property="uniqueCode">
            <![CDATA[#uniqueCode#,]]>
        </isNotEmpty>
					<include refid="BINBEMQMES02.saleValueDetailSql" />		
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
    		)
    	]]>
    </insert>
    
    <!-- 插入历史销售业务数据主表 -->
    <insert id="addSaleRecordHistory" parameterClass="java.util.HashMap">
    	<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_SaleRecordHistoryID" >  
		    	<![CDATA[
    		INSERT INTO Sale.BIN_SaleRecordHistory
    		(
    			]]>
					<include refid="BINBEMQMES02.saleKeyMainSql" />		
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
    		VALUES
    		(
    			 ]]>
					<include refid="BINBEMQMES02.saleValueMainSql" />		
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
    		)
			  	 SELECT SCOPE_IDENTITY() AS value     
			]]> 
	    </selectKey>
    </insert>
    
    <!-- 插入销售业务详细数据历史表 -->
    <insert id="addSaleDetailHistory" parameterClass="java.util.HashMap">
    	<![CDATA[
    		INSERT INTO Sale.BIN_SaleDetailHistory
    		(
    			BIN_SaleRecordHistoryID,
    			]]>
					<include refid="BINBEMQMES02.saleKeyDetailSql" />		
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
    		VALUES
    		(
    			 #saleRecordHistoryID#,
    			 ]]>
					<include refid="BINBEMQMES02.saleValueDetailSql" />		
					<include refid="BINOLCMINC99.insertValueSql" />		
				 <![CDATA[
    		)
    	]]>
    </insert>
    
    <!-- 删除销售业务数据主表 -->
    <delete id="delSaleRecord" parameterClass="java.util.HashMap">
    	DELETE FROM
    		Sale.BIN_SaleRecord
    	WHERE
    		BIN_SaleRecordID = #saleRecordID#
    </delete>
    
    <!-- 删除销售业务数据明细表 -->
    <delete id="delSaleRecordDetail" parameterClass="java.util.HashMap">
    	DELETE FROM
    		Sale.BIN_SaleRecordDetail
    	WHERE
    		BIN_SaleRecordID = #saleRecordID#
    </delete>
    
    <!-- 删除产品入出库数据主表 -->
    <delete id="delProductInOut" parameterClass="java.util.HashMap">
    	DELETE FROM
    		Inventory.BIN_ProductInOut
    	WHERE
    		BIN_ProductInOutID = #productInOutID#
    </delete>
    
    <!-- 删除产品入出库数据明细表 -->
    <delete id="delProductInOutDetail" parameterClass="java.util.HashMap">
    	DELETE FROM
    		Inventory.BIN_ProductInOutDetail
    	WHERE
    		BIN_ProductInOutID = #productInOutID#
    </delete>
    
    <!-- 插入产品入出库数据主表 -->
    <insert id="addProductInOut" parameterClass="java.util.HashMap">
    	<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductInOutID" >      
	        <![CDATA[
    		INSERT INTO Inventory.BIN_ProductInOut
    		(
				]]>
					<include refid="BINBEMQMES02.prtStockInOutKeyMainSql" />
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
    		VALUES
    		(
    		    ]]>		
    		    	<include refid="BINBEMQMES02.prtStockInOutValueMainSql" />
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
    		)
			  	select SCOPE_IDENTITY() as value    
			]]> 
	    </selectKey>
    </insert>
    
    <!-- 插入产品入出库明细表 -->
    <insert id="addProductInOutDetail" parameterClass="java.util.HashMap">
     	<![CDATA[
     		INSERT INTO Inventory.BIN_ProductInOutDetail
     		(
     			BIN_ProductInOutID,
				]]>
					<include refid="BINBEMQMES02.prtStockInOutKeyDetailSql" />
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
     		)
     		VALUES
     		(
     			#productInOutID#,
     			]]>
     				<include refid="BINBEMQMES02.prtStockInOutValueDetailSql" />		
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
     		)
     	]]>
    </insert>
    
    <!-- 查询产品入出库主表 -->
    <select id ="selProductInOut" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
		<![CDATA[
			SELECT 
				A.BIN_ProductInOutID AS productInOutID,
				A.BIN_OrganizationInfoID AS organizationInfoID,
				A.BIN_BrandInfoID AS brandInfoID,
				A.TradeNo AS stockInOut_tradeNo,
				A.TradeNoIF AS stockInOut_tradeNoIF,
				A.RelevanceNo AS stockInOut_relevantNo,
				A.StockType AS stockInOutType,
				A.BIN_OrganizationID AS organizationID,
				A.BIN_EmployeeID AS employeeID,
				A.TotalQuantity AS totalQuantity,
				A.TotalAmount AS totalAmount,
				A.TradeType AS cherry_tradeType,
				A.BIN_LogisticInfoID AS logisticInfoID,
				A.Comments AS reason,
				A.StockInOutDate AS tradeDate,
				A.StockInOutTime AS stockInOutTime,
				A.VerifiedFlag AS verifiedFlag,
				A.TotalAmountBefore AS totalAmountBefore,
				A.TotalAmountAfter AS totalAmountAfter,
				A.CloseFlag AS closeFlag,
				A.ChangeCount AS modifyCounts,
				A.CreateTime AS createTime,
				A.CreatedBy AS createBy,
				A.CreatePGM AS createPGM
			FROM
				Inventory.BIN_ProductInOut A
			WHERE
				A.ValidFlag = '1' AND
				A.BIN_ProductInOutID = (
				  SELECT  
				       top 1 BIN_ProductInOutID AS tempProductInOutID  
				  FROM 
				       Inventory.BIN_ProductInOut B
				  where 
				       B.RelevanceNo = #tradeNoIF#
				  order by 
				       B.CreateTime desc )
		]]>	
	</select>
    
    <!-- 查询产品入出库明细表 -->
   	<select id ="selProductInOutDetail" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
		<![CDATA[
			SELECT 
				A.BIN_ProductInOutID AS productInOutID,
				A.BIN_ProductVendorID AS productVendorID,
				A.DetailNo AS detailNo,
				A.Quantity AS quantity,
				A.Price AS price,
				A.BIN_ProductVendorPackageID AS productVendorPackageID,
				A.StockType AS stockType,
				A.BIN_InventoryInfoID AS inventoryInfoID,
				A.BIN_LogicInventoryInfoID AS logicInventoryInfoID,
				A.BIN_StorageLocationInfoID AS storageLocationInfoID,
				A.Comments AS reason,
				A.ChangeCount AS modifyCounts
			FROM
				Inventory.BIN_ProductInOutDetail A
			WHERE
				A.ValidFlag = '1' AND
				A.BIN_ProductInOutID = #productInOutID#
		]]>	
	</select>
    
    
    
    <!-- 插入历史产品入出库数据主表 -->
    <insert id="addProductInOutHistory" parameterClass="java.util.HashMap">
    	<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductInOutHistoryID" >      
	        <![CDATA[
    		INSERT INTO Inventory.BIN_ProductInOutHistory
    		(
				]]>
					<include refid="BINBEMQMES02.prtStockInOutKeyMainSql" />
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
    		VALUES
    		(
    		    ]]>		
    		    	<include refid="BINBEMQMES02.prtStockInOutValueMainSql" />
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
    		)
			  	select SCOPE_IDENTITY() as value 
			]]> 
	    </selectKey>
    </insert>
    
    <!-- 插入历史产品入出库明细表 -->
    <insert id="addProductInOutDetailHistory" parameterClass="java.util.HashMap">
     	<![CDATA[
     		INSERT INTO Inventory.BIN_ProductInOutDetailHistory
     		(
     			BIN_ProductInOutHistoryID,
				]]>
					<include refid="BINBEMQMES02.prtStockInOutKeyDetailSql" />
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
     		)
     		VALUES
     		(
     			#productInOutHistoryID#,
     			]]>
     				<include refid="BINBEMQMES02.prtStockInOutValueDetailSql" />		
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
     		)
     	]]>
    </insert>
    
    
    <!-- 查询产品库存数据 -->
	<select id="selPrtStockNumInfo" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
	<![CDATA[
		SELECT
			Quantity AS stockQuantity
		FROM
			Inventory.BIN_ProductStock A
		WHERE
			A.BIN_ProductVendorID = #productVendorID# AND
		    ]]>
			<isNotEmpty property="logicInventoryInfoID">
    		  A.BIN_LogicInventoryInfoID = #logicInventoryInfoID# AND
			</isNotEmpty>
			<![CDATA[ 
			A.BIN_InventoryInfoID = #inventoryInfoID# AND
			A.ValidFlag = '1'
	]]> 
	</select>
    
    <!-- 查询促销产品收发货 发货部门-->
	<select id="selPrmDev" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
	<![CDATA[
		SELECT 
		      BIN_OrganizationID AS sendOrganizationID
		FROM 
		      Inventory.BIN_PromotionDeliver A
		WHERE 
		      A.DeliverReceiveNo = #relevantNo# AND 
			  A.ValidFlag = '1'
	]]> 
	</select>
    <!-- 更新产品库存 -->
    <update id="updProductStock" parameterClass="java.util.HashMap">
    	<![CDATA[
    	UPDATE
    		Inventory.BIN_ProductStock
    	SET
    		Quantity =Quantity + #updQuantity#,
			]]>
			<include refid="BINOLCMINC99.updateSql" />
			<![CDATA[
    	WHERE
    		BIN_ProductVendorID = #productVendorID# AND
    		BIN_InventoryInfoID = #inventoryInfoID#
			]]>
			<isNotEmpty property="logicInventoryInfoID">
				AND BIN_LogicInventoryInfoID = #logicInventoryInfoID#
			</isNotEmpty>
			<isNotEmpty property="productVendorPackageID">
				<isNotEqual property="productVendorPackageID" compareValue="0" >
				AND BIN_ProductVendorPackageID = #productVendorPackageID#
			    </isNotEqual>
			</isNotEmpty>
		    <isNotEmpty property="storageLocationInfoID">
				<isNotEqual property="storageLocationInfoID" compareValue="0" >
				AND  BIN_StorageLocationInfoID = #storageLocationInfoID#
			    </isNotEqual>
			</isNotEmpty>
    </update>
    
    <!-- 插入产品库存表 -->
    <insert id="addProductStock" parameterClass="java.util.HashMap">
    	<![CDATA[
    		INSERT INTO Inventory.BIN_ProductStock
    		(
    			BIN_ProductVendorID,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Quantity,
				BIN_ProductVendorPackageID,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)	
    		VALUES
    		(
     			#productVendorID#,
     			#inventoryInfoID#,
     			#logicInventoryInfoID#,
     			'0',
     			#stockQuantity#,
     			'0',
     			]]>		
					<include refid="BINOLCMINC99.insertValueSql" />		
				<![CDATA[
    		)
    	]]>
    </insert>
    
    <!-- 插入产品收货表 -->
    <insert id="addProductReceive" parameterClass="java.util.HashMap">
    	<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductReceiveID" >      
	            	<![CDATA[
    		INSERT INTO Inventory.BIN_ProductReceive
    		(
    			BIN_OrganizationInfoID,
				BIN_BrandInfoID,
				ReceiveNo,
				ReceiveNoIF,
				RelevanceNo,
				BIN_OrganizationID,
				BIN_OrganizationIDReceive,
				BIN_EmployeeID,
				BIN_OrganizationIDDX,
				BIN_EmployeeIDDX,
				TotalQuantity,
				TotalAmount,
				VerifiedFlag,
				TradeStatus,
				BIN_LogisticInfoID,
				Comments,
				ReceiveDate,
				WorkFlowID,
				SynchFlag,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
    		VALUES
    		(
    			#organizationInfoID#,
    			#brandInfoID#,
				#cherry_no#,
				#tradeNoIF#,
    			#relevantNo#,
    			#organizationIDSend#,
    			#organizationID#,
    			#employeeID#,
    			#organizationIDDX#,
    			#employeeIDDX#,
    			#totalQuantity#,
    			#totalAmount#,
    			#verifiedFlag#,
    			'12',
    			'0',
    			#reason#,
    			#tradeDate#,
    			#WorkFlowID#,
    			#SynchFlag#,
    			]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
    		)
			  	select SCOPE_IDENTITY() as value     
			]]> 
	    </selectKey>
    </insert>
    
    <!-- 插入产品收货明细表 -->
    <insert id="addProductReceiveDetail" parameterClass="java.util.HashMap">
    	<![CDATA[
    		INSERT INTO Inventory.BIN_ProductReceiveDetail
    		(
    		    BIN_ProductReceiveID,
				BIN_ProductVendorID,
				DetailNo,
				Quantity,
				Price,
				ReferencePrice,
				BIN_ProductVendorPackageID,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Comments,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
    		)
			VALUES
			(
				#productReceiveID#,
				#productVendorID#,
				#detailNo#,
				#quantity#,
				#price#,
				#referencePrice#,
				'0',
				#inventoryInfoID#,
				#logicInventoryInfoID#,
				'0',
				#reason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
    	]]>
    </insert>
    
    <!-- 插入产品退库主表 -->
    <insert id="addProductReturn" parameterClass="java.util.HashMap">
    	<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductReturnID" >      
	           	<![CDATA[
    	INSERT INTO Inventory.BIN_ProductReturn
    	(
    		BIN_OrganizationInfoID,
			BIN_BrandInfoID,
			ReturnNo,
			ReturnNoIF,
			BIN_OrganizationID,
			BIN_OrganizationIDReceive,
			BIN_EmployeeID,
			BIN_OrganizationIDDX,
			BIN_EmployeeIDDX,
			TotalQuantity,
			TotalAmount,
			VerifiedFlag,
			TradeType,
			RelevanceNo,
			BIN_LogisticInfoID,
			Reason,
			ReturnDate,
			]]>
				<include refid="BINOLCMINC99.insertKeySql" />		
			<![CDATA[
    	)
		VALUES
		(
			#organizationInfoID#,
			#brandInfoID#,
			#cherry_no#,
			#tradeNoIF#,
			#organizationID#,
			#organizationIDReceive#,
			#employeeID#,
			#organizationIDDX#,
			#employeeIDDX#,
			#totalQuantity#,
			#totalAmount#,
			#verifiedFlag#,
			#cherry_tradeType#,
			#relevantNo#,
			'0',
			#reason#,
			#tradeDate#,
			]]>
				<include refid="BINOLCMINC99.insertValueSql" />
			<![CDATA[
		)
			  	select SCOPE_IDENTITY() as value     
			]]> 
	    </selectKey>
    </insert>
    
	<!-- 插入产品退库明细表 -->
	<insert id="addProductReturnDetail" parameterClass="java.util.HashMap">
		<![CDATA[
			INSERT INTO Inventory.BIN_ProductReturnDetail
			(
				BIN_ProductReturnID,
				BIN_ProductVendorID,
				DetailNo,
				Quantity,
				Price,
				BIN_ProductVendorPackageID,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Reason,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#productReturnID#,
				#productVendorID#,
				#detailNo#,
				#quantity#,
				#price#,
				'0',
				#inventoryInfoID#,
				#logicInventoryInfoID#,
				'0',
				#reason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
	</insert>
	
	<!-- 插入产品调拨申请单据主表 -->
	<insert id="addProductAllocation" parameterClass="java.util.HashMap">
		<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductAllocationID" >      
	       		<![CDATA[
			INSERT INTO Inventory.BIN_ProductAllocation
			(
				BIN_OrganizationInfoID,
				BIN_BrandInfoID,
				AllocationrNo,
				AllocationNoIF,
				BIN_OrganizationIDIn,
				BIN_OrganizationIDOut,
				BIN_EmployeeID,
                BIN_OrganizationIDDX,
                BIN_EmployeeIDDX,
				TotalQuantity,
				TotalAmount,
				VerifiedFlag,
				TradeStatus,
				Comments,
				Date,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#organizationInfoID#,
				#brandInfoID#,
				#cherry_no#,
                #tradeNoIF#,
				#organizationID#,
				#relevantOrganizationID#,
				#employeeID#,
				#organizationIDDX#,
				#employeeIDDX#,
				#totalQuantity#,
				#totalAmount#,
				#verifiedFlag#,
				'10',
				#reason#,
				#tradeDate#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
			  	select SCOPE_IDENTITY() as value    
			]]> 
	    </selectKey>
	</insert>
	
	<!-- 插入产品调拨申请单据明细表 -->
	<insert id="addProductAllocationDetail" parameterClass="java.util.HashMap">
		<![CDATA[
			INSERT INTO Inventory.BIN_ProductAllocationDetail
			(
				BIN_ProductAllocationID,
				BIN_ProductVendorID,
				DetailNo,
				Quantity,
				Price,
				BIN_ProductVendorPackageID,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Comments,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#productAllocationID#,
				#productVendorID#,
				#detailNo#,
				#quantity#,
				#price#,
				'0',
				#inventoryInfoID#,
				#logicInventoryInfoID#,
				'0',
				#reason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
	</insert>
	
    <!--更新【产品调拨申请单据表】-->
    <update id="updateProductAllocation" parameterClass="java.util.HashMap">
        <![CDATA[
            UPDATE
                Inventory.BIN_ProductAllocation
            SET
                UpdateTime = GETDATE()
                ,UpdatedBy = #UpdatedBy#
                ,UpdatePGM = #UpdatePGM#
                ,ModifyCount = ModifyCount+1
        ]]>
        <dynamic>
            <isNotEmpty property="TradeStatus">
                 <![CDATA[,TradeStatus = #TradeStatus#]]>
            </isNotEmpty>
        </dynamic>
        <![CDATA[
            WHERE
                AllocationNoIF = #AllocationNoIF#
                AND ValidFlag = '1'
        ]]>
    </update>
	
	<!-- 插入产品调出单据主表 -->
	<insert id="addProductAllocationOut" parameterClass="java.util.HashMap">

		<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductAllocationOutID" >      
	        		<![CDATA[
			INSERT INTO Inventory.BIN_ProductAllocationOut
			(
				BIN_OrganizationInfoID,
				BIN_BrandInfoID,
				AllocationOutNo,
				AllocationOutNoIF,
				RelevanceNo,
				BIN_OrganizationIDIn,
				BIN_OrganizationIDOut,
				BIN_EmployeeID,
				BIN_OrganizationIDDX,
				BIN_EmployeeIDDX,
				TotalQuantity,
				TotalAmount,
				VerifiedFlag,
				TradeStatus,
				Comments,
				Date,
				SynchFlag,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#organizationInfoID#,
				#brandInfoID#,
				#cherry_no#,
				#tradeNoIF#,
				#relevantNo#,
				#relevantOrganizationID#,
				#organizationID#,
				#employeeID#,
				#organizationIDDX#,
				#employeeIDDX#,
				#totalQuantity#,
				#totalAmount#,
				#verifiedFlag#,
				#tradeStatus#,
				#reason#,
				#tradeDate#,
				'1',
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
			<![CDATA[
			  	select SCOPE_IDENTITY() as value     
			]]> 
	    </selectKey>
	</insert>
	
	<!-- 插入产品调出单据明细表 -->
	<insert id="addProductAllocationOutDetail" parameterClass="java.util.HashMap">
		<![CDATA[
			INSERT INTO Inventory.BIN_ProductAllocationOutDetail
			(
				BIN_ProductAllocationOutID,
				BIN_ProductVendorID,
				DetailNo,
				Quantity,
				Price,
				BIN_ProductVendorPackageID,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Comments,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
				
			)
			VALUES
			(
				#productAllocationOutID#,
				#productVendorID#,
				#detailNo#,
				#quantity#,
				#price#,
				'0',
				#inventoryInfoID#,
				#logicInventoryInfoID#,
				'0',
				#reason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
	</insert>
	
	<!-- 插入产品调入单据主表 -->
	<insert id="addProductAllocationIn" parameterClass="java.util.HashMap">
		<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductAllocationOutID" >   
		<![CDATA[
			INSERT INTO Inventory.BIN_ProductAllocationIn
			(
				BIN_OrganizationInfoID,
				BIN_BrandInfoID,
				AllocationInNo,
				AllocationInNoIF,
				RelevanceNo,
				BIN_OrganizationIDIn,
				BIN_OrganizationIDOut,
				BIN_EmployeeID,
				BIN_OrganizationIDDX,
				BIN_EmployeeIDDX,
				TotalQuantity,
				TotalAmount,
				VerifiedFlag,
				TradeStatus,
				Comments,
				Date,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#organizationInfoID#,
				#brandInfoID#,
				#cherry_no#,
				#cherry_no#,
				#tradeNoIF#,
				#relevantOrganizationID#,
				#organizationID#,
				#employeeID#,
				#organizationIDDX#,
				#employeeIDDX#,
				#totalQuantity#,
				#totalAmount#,
				#verifiedFlag#,
				#tradeStatus#,
				#reason#,
				#tradeDate#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
			  	select SCOPE_IDENTITY() as value    
			]]> 
	    </selectKey>
	</insert>
	
	<!-- 插入产品调入单据明细表 -->
	<insert id="addProductAllocationInDetail" parameterClass="java.util.HashMap">
		<![CDATA[
			INSERT INTO Inventory.BIN_ProductAllocationInDetail
			(
				BIN_ProductAllocationInID,
				BIN_ProductVendorID,
				DetailNo,
				Quantity,
				Price,
				BIN_ProductVendorPackageID,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Comments,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
				
			)
			VALUES
			(
				#productAllocationInID#,
				#productVendorID#,
				#detailNo#,
				#quantity#,
				#price#,
				'0',
				#inventoryInfoID#,
				#logicInventoryInfoID#,
				'0',
				#reason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
	</insert>
	
	<!-- 插入产品盘点单据主表 -->
	<insert id="addProductStockTaking" parameterClass="java.util.HashMap">
		<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductStockTakingID" >      
	        		<![CDATA[
			INSERT INTO Inventory.BIN_ProductStockTaking
			(
				BIN_OrganizationInfoID,
				BIN_BrandInfoID,
				StockTakingNo,
				StockTakingNoIF,
				BIN_OrganizationID,
				BIN_EmployeeID,
				BIN_OrganizationIDDX,
				BIN_EmployeeIDDX,
				TotalQuantity,
				TotalAmount,
				VerifiedFlag,
				Type,
				Comments,
				Date,
				TradeTime,
				StockReason,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#organizationInfoID#,
				#brandInfoID#,
				#cherry_no#,
				#tradeNoIF#,
				#organizationID#,
				#employeeID#,
                #organizationIDDX#,
                #employeeIDDX#,
				#totalQuantity#,
				#totalAmount#,
				#verifiedFlag#,
				#subType#,
				#reason#,
				#tradeDate#,
				#tradeTime#,
				#stockReason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
			  	select SCOPE_IDENTITY() as value    
			]]> 
	    </selectKey>
	</insert>
	
	<!-- 插入产品盘点单据明细表 -->
	<insert id="addProductTakingDetail" parameterClass="java.util.HashMap">
		<![CDATA[
			INSERT INTO Inventory.BIN_ProductTakingDetail
			(
				BIN_ProductTakingID,
				BIN_ProductVendorID,
				DetailNo,
				Quantity,
				Price,
				BIN_ProductVendorPackageID,
				GainQuantity,
				BIN_InventoryInfoID,
				BIN_LogicInventoryInfoID,
				BIN_StorageLocationInfoID,
				Comments,
				HandleType,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#productTakingID#,
				#productVendorID#,
				#detailNo#,
				#quantityBefore#,
				#price#,
				'0',
				#gainQuantity#,
				#inventoryInfoID#,
				#logicInventoryInfoID#,
				'0',
				#reason#,
				#reason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
	</insert>
	<!-- 插入产品订货单据主表 -->
	<!--
	<insert id="addProductOrder" parameterClass="java.util.HashMap">
		<selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_ProductAllocationID" >      
	        		<![CDATA[
			INSERT INTO Inventory.BIN_ProductOrder
			(
				BIN_OrganizationInfoID,
		        BIN_BrandInfoID,
		        OrderNo,
		        OrderNoIF,
		        BIN_OrganizationID,
		        BIN_OrganizationIDAccept,
		        BIN_EmployeeID,
				SuggestedQuantity,
		        TotalQuantity,
		        TotalAmount,
		        VerifiedFlag,
		        TradeStatus,
		        Comments,
		        Date,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#organizationInfoID#,
				#brandInfoID#,
				#cherry_no#,
				#tradeNoIF#,
				#organizationID#,
				#relevantOrganizationID#,
				#employeeID#,
				#suggestedTotalQuantity#,
				#totalQuantity#,
				#totalAmount#,
				#verifiedFlag#,
				'10',
				#reason#,
				#tradeDate#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
			<![CDATA[
			  	select SCOPE_IDENTITY() as value    
			]]> 
	    </selectKey>
	</insert>
	-->
	
	<!-- 插入产品订货单据明细表 -->
	<!--
	<insert id="addProductOrderDetail" parameterClass="java.util.HashMap">
		<![CDATA[
			INSERT INTO Inventory.BIN_ProductOrderDetail
			(
		        BIN_ProductOrderID,
		        BIN_ProductVendorID,
		        DetailNo,
				SuggestedQuantity,
		        Quantity,
		        Price,
		        BIN_ProductVendorPackageID,
		        BIN_InventoryInfoID,
		        BIN_LogicInventoryInfoID,
		        Comments,
				]]>
					<include refid="BINOLCMINC99.insertKeySql" />		
				<![CDATA[
			)
			VALUES
			(
				#productOrderID#,
				#productVendorID#,
				#detailNo#,
				#suggestedQuantity#,
				#quantity#,
				#price#,
				'0',
				#inventoryInfoID#,
				#logicInventoryInfoID#,
				#reason#,
				]]>
					<include refid="BINOLCMINC99.insertValueSql" />
				<![CDATA[
			)
		]]>
	</insert>
	-->
	
	<!-- 查询产品信息 ,获得结算价格 根据产品厂商ID -->
	<select id="selPrtGetPriceByPrtVenID" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
		SELECT 
			B.BIN_ProductVendorID AS productVendorID,
			A.StandardCost AS standardCost
		FROM
			Basis.BIN_Product A,
			Basis.BIN_ProductVendor B
		WHERE
			A.BIN_ProductID = B.BIN_ProductID AND
			B.BIN_ProductVendorID = #BIN_ProductVendorID#
	</select>
	
	<!-- 查询发货单据号 -->
	<select id="selPrtDeliverInfo" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
		<![CDATA[
		SELECT  
		    A.BIN_OrganizationID AS organizationIDSend,
		    A.WorkFlowID,
		    A.BIN_ProductDeliverID
		FROM  
		    Inventory.BIN_ProductDeliver A
	    WHERE 
		    A.DeliverNoIF=#relevantNo# AND
			A.ValidFlag = '1'
		]]>
	</select>
	
    <!-- 查询发货单据号 -->
    <select id="selPrtDeliverList" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
        <![CDATA[
        SELECT  
            A.BIN_ProductDeliverID,
			A.DeliverNo
        FROM  
            Inventory.BIN_ProductDeliver A
        WHERE 
            (A.DeliverNoIF = #DeliverNoIF# OR A.DeliverNo = #DeliverNoIF#)
            AND A.ValidFlag = '1'
        ]]>
    </select>
    
    <!-- 查询发货单据号根据WorkFlowID -->
    <select id="selPrtDeliverListByWorkFlowID" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
        <![CDATA[
        SELECT  
            A.BIN_ProductDeliverID,
            A.DeliverNo
        FROM  
            Inventory.BIN_ProductDeliver A
        WHERE 
            A.WorkFlowID = #WorkFlowID#
            AND A.ValidFlag = '1'
        ]]>
    </select>
	
	<!-- 查询订货单信息 -->
    <select id="selPrtOrderList" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
        <![CDATA[
        SELECT
            A.BIN_ProductOrderID,
            A.BIN_OrganizationID,
            A.BIN_InventoryInfoID,
            A.BIN_LogicInventoryInfoID,
            A.BIN_OrganizationIDAccept,
            A.BIN_InventoryInfoIDAccept,
            A.BIN_LogicInventoryInfoIDAccept,
            A.WorkFlowID,
            A.VerifiedFlag
        FROM  
            Inventory.BIN_ProductOrder A
        WHERE 
            (A.OrderNoIF = #OrderNoIF# OR A.OrderNo = #OrderNoIF#)
            AND A.ValidFlag = '1'
        ]]>
    </select>
	
    <!-- 更新产品收货业务单据表 -->
    <update id="updProductReceive" parameterClass="java.util.HashMap">
    <![CDATA[
        UPDATE
            Inventory.BIN_ProductReceive
        SET 
            TotalQuantity = #TotalQuantity#,
            TotalAmount = #TotalAmount#
        WHERE
            BIN_ProductReceiveID = #BIN_ProductReceiveID# AND
            ValidFlag = '1'
    ]]>
    </update>
	
    <!-- 插入礼品领用主表 -->
    <insert id="addGiftDraw" parameterClass="java.util.HashMap">
        <selectKey resultClass="java.lang.Integer" type="post" keyProperty="BIN_GiftDrawID" >   
        <![CDATA[
            INSERT INTO Inventory.BIN_GiftDraw
            (
                BIN_OrganizationInfoID,
                BIN_BrandInfoID,
                BIN_OrganizationID,
                BillNo,
                BillNoIF,
                RelevanceNo,
                TradeType,
                SubType,
                CouponCode,
                CampaignCode,
                EmployeeCode,
                BIN_EmployeeID,
                MemberCode,
                BIN_MemberInfoID,
                Amount,
                Quantity,
                TradeDate,
                TradeDateTime,
                InformType,
                BillState,
                WorkFlowID,
                ModifiedTimes,
                Comments,
        ]]>
        <include refid="BINOLCMINC99.insertKeySql" />
        <![CDATA[
            )
            VALUES
            (
                #organizationInfoID#,
                #brandInfoID#,
                #organizationID#,
                #stockBirPresent_no#,
                #tradeNoIF#,
                #relevantNo#,
                #tradeType#,
                #subType#,
                #couponCode#,
                #campaignCode#,
                #BAcode#,
                #employeeID#,
                #memberCode#,
                #memberInfoID#,
                #totalAmount#,
                #totalQuantity#,
                #tradeDate#,
                #tradeDateTime#,
                #informType#,
                #billState#,
                #workFlowID#,
                #modifyCounts#,
                #reason#,
        ]]>
        <include refid="BINOLCMINC99.insertValueSql" />
        <![CDATA[
            )
                select SCOPE_IDENTITY() as value
        ]]> 
        </selectKey>
    </insert>
    
    <!-- 插入礼品领用明细表 -->
    <insert id="addGiftDrawDetail" parameterClass="java.util.HashMap">
        <![CDATA[
            INSERT INTO Inventory.BIN_GiftDrawDetail
            (
                BIN_GiftDrawID,
                MainCode,
                BIN_ProductVendorID,
                UnitCode,
                BarCode,
                DetailNo,
                InventoryTypeCode,
                BIN_LogicInventoryInfoID,
                Price,
                Quantity,
                GiftType,
                Comment,
                ModifiedTimes,
        ]]>
        <include refid="BINOLCMINC99.insertKeySql" />
        <![CDATA[
            )
            VALUES
            (
                #giftDrawID#,
                #mainCode#,
                #productVendorID#,
                #unitcode#,
                #barcode#,
                #detailNo#,
                #inventoryTypeCode#,
                #logicInventoryInfoID#,
                #price#,
                #quantity#,
                #giftType#,
                #reason#,
				#modifyCounts#,
        ]]>
        <include refid="BINOLCMINC99.insertValueSql" />
        <![CDATA[
            )
        ]]>
    </insert>
    
	<!-- 更新销售业务数据主表-->
    <update id="updSaleRecord" parameterClass="java.util.HashMap">
    <![CDATA[
        UPDATE
            Sale.BIN_SaleRecord
        SET
            Comments = #tradeNoIF#,
	]]>
    <include refid="BINOLCMINC99.updateSql" />
    <![CDATA[
        WHERE
            BillCode = #relevantNo# AND
            ValidFlag = '1'
    ]]>
    </update>
    
    <!-- 更改销售单据状态 -->
    <update id="updSaleRecordBillState" parameterClass="java.util.HashMap">
    <![CDATA[
        UPDATE
            Sale.BIN_SaleRecord
        SET
    ]]>
    <isNotEmpty property="billState">
        <![CDATA[BillState = #billState#,]]>
    </isNotEmpty>
    <isNotEmpty property="comment">
        <isEqual property="comment" compareValue="cherry_clear">
            <![CDATA[Comments = NULL,]]>
        </isEqual>
        <isNotEqual property="comment" compareValue="cherry_clear">
            <![CDATA[Comments = #comment#,]]>
        </isNotEqual>
    </isNotEmpty>
    <include refid="BINOLCMINC99.updateSql" />
    <![CDATA[
        WHERE
            BillCode = #tradeNoIF#
            AND ValidFlag = '1'
    ]]>
    </update>
	
    <!-- 插入销售支付构成表 -->
    <insert id="addSalePayList" parameterClass="java.util.HashMap">
    <![CDATA[
        INSERT INTO Sale.BIN_SalePayList
        (
            BIN_SaleRecordID,
            DetailNo,
            PayTypeCode,
            PayAmount,
            SerialNumber,
            Comment,
    ]]>
    <include refid="BINOLCMINC99.insertKeySql" />
    <![CDATA[
        )
        VALUES
        (
            #saleRecordID#,
            #detailNo#,
            #payTypeCode#,
            #price#,
            #serialNumber#,
            #reason#,
    ]]>
    <include refid="BINOLCMINC99.insertValueSql" />
    <![CDATA[
        )
    ]]>
    </insert>
    
    <!-- 查询促销活动主码 -->
    <select id="getActivityMainCodeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT DISTINCT
                MainCode,
                ActivityType
            FROM
                Promotion.BIN_ActivityTransHis
            WHERE
                CountActCode = #activityCode#
                AND BIN_OrganizationInfoID = #organizationInfoID#
                AND BIN_BrandInfoID = #brandInfoID#
        ]]>
    </select>
    
    <!-- 查询促销活动组的活动组代号 -->
    <select id="getPrmActGroupCodeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT DISTINCT
                A.GroupCode
            FROM
                Promotion.BIN_PromotionActGrp A
            JOIN Promotion.BIN_PromotionActivity B
            ON A.BIN_PromotionActGrpID = B.BIN_PromotionActGrpID
            WHERE
                B.ActivityCode = #ActivityCode#
                AND B.BIN_BrandInfoID = #BIN_BrandInfoID#
                AND B.BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
        ]]>
    </select>
    
    <!-- 查询会员活动表的活动代号 -->
    <select id="getCampaignCodeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT DISTINCT
                A.CampaignCode
            FROM
                Campaign.BIN_Campaign A
            JOIN Campaign.BIN_CampaignRule B
            ON A.BIN_CampaignID = B.BIN_CampaignID
            WHERE
                B.SubCampaignCode = #ActivityCode#
                AND A.BIN_BrandInfoID = #BIN_BrandInfoID#
                AND A.BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
        ]]>
    </select>
    
    <!-- 查询CampaignCode是否在会员活动表存在 -->
    <select id="getCampaignList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT DISTINCT
                A.BIN_CampaignID
            FROM
                Campaign.BIN_Campaign A
            WHERE
                A.CampaignCode = #CampaignCode#
        ]]>
    </select>
    
    <!-- 插入会员参与活动履历表 -->
    <insert id="addCampaignHistory" parameterClass="java.util.HashMap">
        <![CDATA[
            INSERT INTO Campaign.BIN_CampaignHistory(
                OrgCode,
                BrandCode,
                BIN_MemberInfoID,
                CampaignType,
                CampaignCode,
                MainCode,
                TradeNoIF,
                TradeType,
                State,
                BIN_OrganizationID,
                ParticipateTime,
                InformType,
        ]]>
        <include refid="BINOLCMINC99.insertKeySql" />
        <![CDATA[
            )
            VALUES
            (
                #OrgCode#,
                #BrandCode#,
                #BIN_MemberInfoID#,
                #CampaignType#,
                #CampaignCode#,
                #MainCode#,
                #TradeNoIF#,
                #TradeType#,
                #State#,
                #BIN_OrganizationID#,
                #ParticipateTime#,
                #InformType#,
        ]]>
        <include refid="BINOLCMINC99.insertValueSql" />
        <![CDATA[
            )
        ]]>
    </insert>
    
    <!-- 删除会员参与活动履历表 -->
    <delete id="delCampaignHistory" parameterClass="java.util.HashMap">
        <![CDATA[
            DELETE FROM
                Campaign.BIN_CampaignHistory
            WHERE
                TradeNoIF = #TradeNoIF#
        ]]>
        <isNotEmpty property="BIN_MemberInfoID">
            <![CDATA[
                AND BIN_MemberInfoID = #BIN_MemberInfoID#
            ]]>
        </isNotEmpty>
        <isNotEmpty property="CampaignCode">
            <![CDATA[
                AND CampaignCode = #CampaignCode#
            ]]>
        </isNotEmpty>
        <isNotEmpty property="MainCode">
            <![CDATA[
                AND MainCode = #MainCode#
            ]]>
        </isNotEmpty>
        <![CDATA[
                AND OrgCode = #OrgCode#
                AND BrandCode = #BrandCode#
        ]]>
    </delete>
    
    <!-- 查询会员活动履历表的MainCode -->
    <select id="getCampaignHistoryList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT DISTINCT
                A.MainCode
            FROM
                Campaign.BIN_CampaignHistory A WITH(NOLOCK)
            WHERE
                A.CampaignCode = #CampaignCode#
                AND A.TradeNoIF = #TradeNoIF#
                AND A.TradeType = #TradeType#
                AND A.State = #State#
        ]]>
    </select>
    
    <!-- 查询会员活动预约主表信息 -->
    <select id="getCampaignOrderList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT
                BIN_CampaignOrderID,
                TradeType,
                SubType,
                CampaignCode,
                State
            FROM
                Campaign.BIN_CampaignOrder A WITH(NOLOCK)
            WHERE
                A.TradeNoIF = #TradeNoIF#
                AND A.ValidFlag = '1'
        ]]>
    </select>
    
    <!-- 查询会员活动预约明细表 -->
    <select id="getCampaignOrderDetailList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT
                MainCode,
                BIN_ProductVendorID,
                GiftType,
                UnitCode,
                BarCode
            FROM
                Campaign.BIN_CampaignOrderDetail A WITH(NOLOCK)
            WHERE
                A.BIN_CampaignOrderID = #BIN_CampaignOrderID#
                AND A.ValidFlag = '1'
        ]]>
    </select>
    
    <!-- 更新会员活动预约主表的预约单状态-->
    <update id="updCampaignOrderState" parameterClass="java.util.HashMap">
	    <![CDATA[
	        UPDATE
	            Campaign.BIN_CampaignOrder
	        SET
	            State = #State#,
	            FinishTime = CASE #State# WHEN 'OK' THEN #FinishTime# ELSE null END,
	    ]]>
        <isNotEmpty property="CounterGot">
            <![CDATA[
                CounterGot = #CounterGot#,
            ]]>
        </isNotEmpty>
	    <include refid="BINOLCMINC99.updateSql" />
	    <![CDATA[
	       WHERE
	           BIN_CampaignOrderID = #BIN_CampaignOrderID#
	    ]]>
    </update>
    
    <!-- 通过生日礼领用单据号查询礼品领用主表-->
    <select id ="selGiftDrawNoIF" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
        <![CDATA[
            SELECT
                A.BIN_GiftDrawID
            FROM
                Inventory.BIN_GiftDraw A
            WHERE
                A.BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
                AND A.BIN_BrandInfoID = #BIN_BrandInfoID#
                AND A.BillNoIF = #TradeNoIF#
        ]]>
    </select>
    
    <!-- 查询礼品领用表比较时间(领用的时间比原单的时间要晚)-->
    <select id="getGiftDrawList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT
                BIN_GiftDrawID,
                CONVERT(VARCHAR(30),A.TradeDateTime,121) AS TradeDateTime
            FROM
                Inventory.BIN_GiftDraw A
            WHERE
                A.BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
                AND A.BIN_BrandInfoID = #BIN_BrandInfoID#
                AND A.RelevanceNo = #TradeNoIF#
                AND A.ValidFlag = '1'
        ]]>
        <isNotEmpty property="CampaignCode">
            AND CampaignCode = #CampaignCode#
        </isNotEmpty>
    </select>
    
    <!-- 查询礼品领用明细表的最大DetailNo-->
    <select id="getMaxSPDetailList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT
                A.BIN_GiftDrawID,
                Max(B.DetailNo) AS MaxDetailNo
            FROM Inventory.BIN_GiftDraw A
            JOIN Inventory.BIN_GiftDrawDetail B 
            ON A.BIN_GiftDrawID = B.BIN_GiftDrawID 
            WHERE
                A.BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
                AND BIN_BrandInfoID = #BIN_BrandInfoID#
                AND A.BillNoIF = #TradeNoIF#
            GROUP BY A.BIN_GiftDrawID
        ]]>
    </select>
    
    <!-- 无效礼品领用主表-->
    <update id="delGiftDraw" parameterClass="java.util.HashMap">
        <![CDATA[
            UPDATE
                Inventory.BIN_GiftDraw
            SET
                ValidFlag = '0',
        ]]>
        <include refid="BINOLCMINC99.updateSql" />
        <![CDATA[
            WHERE
                BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
                AND BIN_BrandInfoID = #BIN_BrandInfoID#
                AND BillNoIF = #relevanceNo#
        ]]>
        <isNotEmpty property="CampaignCode">
            <![CDATA[
                AND CampaignCode = #CampaignCode#
            ]]>
        </isNotEmpty>
    </update>
    
    <!-- 无效礼品领用明细表-->
    <update id="delGiftDrawDetail" parameterClass="java.util.HashMap">
        <![CDATA[
            UPDATE
                Inventory.BIN_GiftDrawDetail
            SET
                ValidFlag = '0',
        ]]>
        <include refid="BINOLCMINC99.updateSql" />
        <![CDATA[
            WHERE
                BIN_GiftDrawID IN (
                    SELECT
                        BIN_GiftDrawID
                    FROM
                        Inventory.BIN_GiftDraw
                    WHERE
                        BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
                        AND BIN_BrandInfoID = #BIN_BrandInfoID#
                        AND BillNoIF = #relevanceNo#
        ]]>
        <isNotEmpty property="CampaignCode">
            <![CDATA[
                        AND CampaignCode = #CampaignCode#
            ]]>
        </isNotEmpty>
        <![CDATA[
                )
        ]]>
    </update>
    
    <!-- 查询会员俱乐部ID -->
	<select id="selMemClubId" parameterClass="java.util.HashMap" resultClass ="java.util.HashMap">
	<![CDATA[
		SELECT
			BIN_MemberClubID AS memberClubId
		FROM
			Members.BIN_MemberClub
		WHERE
			ClubCode = #clubCode#
	]]> 
	</select>
    
    <!-- 查询产品调拨申请单据表 -->
    <select id="selProductAllocationList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT
                A.BIN_ProductAllocationID,
                A.BIN_EmployeeIDAudit,
                A.WorkFlowID
            FROM
                Inventory.BIN_ProductAllocation A
            WHERE
                A.AllocationNoIF = #relevantNo#
                AND A.ValidFlag = '1'
        ]]>
    </select>
    
    <!-- 更新BaCoupon-->
    <update id="updateBaCoupon" parameterClass="java.util.HashMap">
        <![CDATA[
            UPDATE
                Basis.BIN_BaCoupon
            SET
                UseFlag = '1',
        ]]>
        <include refid="BINOLCMINC99.updateSql" />
        <![CDATA[
            WHERE
                BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
                AND BIN_BrandInfoID = #BIN_BrandInfoID#
                AND CouponCode IN 
        ]]>
        <iterate property="CouponCodeArr" open="(" close=")" conjunction=",">
            #CouponCodeArr[]#
        </iterate>
    </update>
    
    <!-- 更新电商订单状态，已领用-->
    <update id="updateESOrderMainBillState" parameterClass="java.util.HashMap">
        <![CDATA[
            UPDATE
                Sale.BIN_ESOrderMain
            SET
                BillState = '4',
        ]]>
        <include refid="BINOLCMINC99.updateSql" />
        <![CDATA[
            WHERE
                BIN_OrganizationInfoID = #BIN_OrganizationInfoID#
                AND BIN_BrandInfoID = #BIN_BrandInfoID#
                AND BillCode = #BillCode#
        ]]>
    </update>
    
        <!-- 查询销售退货申请单-->
    <select id="SaleReturnRequestInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        <![CDATA[
            SELECT
                BIN_SaleReturnRequestID,
				WorkFlowID      
            FROM 
            	Sale.BIN_SaleReturnRequest
          	WHERE
				ValidFlag = '1' 
				AND BillCode=#tradeNoIF#
        ]]>
    </select>
</sqlMap>
